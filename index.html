<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        /* Basic Reset & Body Styles */
        :root {
            --primary-color: #007bff; /* Blue */
            --secondary-color: #6c757d; /* Gray */
            --accent-color: #28a745; /* Green */
            --background-color: #f8f9fa; /* Light background */
            --background-color-secondary: #ffffff; /* White for cards */
            --text-color: #343a40; /* Dark text */
            --text-light: #6c757d; /* Lighter text */
            --border-color: #e9ecef; /* Light border */
            --shadow-color: rgba(0, 0, 0, 0.08); /* Light shadow */
            --progress-bar-fill-1: #007bff;
            --progress-bar-fill-2: #ffc107;
            --progress-bar-fill-complete: #28a745;
        }

        body.dark-mode {
            --primary-color: #00bcd4; /* Cyan */
            --secondary-color: #adb5bd; /* Light gray */
            --accent-color: #4caf50; /* Green */
            --background-color: #212529; /* Dark background */
            --background-color-secondary: #343a40; /* Darker gray for cards */
            --text-color: #f8f9fa; /* Light text */
            --text-light: #ced4da; /* Lighter text */
            --border-color: #495057; /* Dark border */
            --shadow-color: rgba(0, 0, 0, 0.4); /* Dark shadow */
            --progress-bar-fill-1: #00bcd4;
            --progress-bar-fill-2: #ffeb3b;
            --progress-bar-fill-complete: #4caf50;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--background-color-secondary);
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .header-left h1 {
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .header-left p {
            font-size: 0.9em;
            color: var(--text-light);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-container {
            display: flex;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            background-color: var(--background-color);
            box-shadow: inset 0 1px 3px var(--shadow-color);
        }

        .search-container input {
            border: none;
            padding: 8px 15px;
            background: transparent;
            color: var(--text-color);
            outline: none;
            flex-grow: 1;
        }

        .search-container button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-container button:hover {
            background-color: var(--primary-color);
            filter: brightness(0.9);
        }

        .theme-toggle-btn {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            cursor: pointer;
            color: var(--text-color);
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }

        .theme-toggle-btn:hover {
            background-color: var(--border-color);
        }

        /* Main Content Grid */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            flex-grow: 1;
        }

        /* Widget Base Style */
        .widget {
            background-color: var(--background-color-secondary);
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .widget-header h2 {
            font-size: 1.5em;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: var(--text-light);
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }

        .close-btn:hover {
            color: var(--primary-color);
        }

        /* Motivational Quote Widget */
        .quote-widget {
            text-align: center;
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
        }

        .quote-widget p {
            font-style: italic;
            color: var(--text-color);
            font-size: 1.1em;
        }

        /* To-Do Card Specifics */
        .todo-card {
            min-height: 250px;
            position: relative;
        }

        .todo-card .card-title-text {
            outline: none;
            border: none;
            padding: 2px 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .todo-card .card-title-text:hover,
        .todo-card .card-title-text:focus {
            background-color: var(--border-color);
        }

        .task-list {
            list-style: none;
            flex-grow: 1; /* Allow list to take available space */
            overflow-y: auto; /* Enable scrolling for long lists */
            margin-bottom: 15px;
            padding-right: 5px; /* Account for scrollbar */
        }

        .task-list li {
            display: flex;
            align-items: center;
            gap: 10px; /* Space between elements */
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .task-list li:last-child {
            border-bottom: none;
        }

        .task-list li .task-label-wrapper {
            flex-grow: 1; /* Allows text and date to take available space */
            display: flex;
            flex-direction: column; /* Stack text and date vertically */
        }

        .task-list li .task-text {
            font-size: 1em;
            padding: 2px 0; /* Adjust padding as needed */
            outline: none;
            min-width: 100px; /* Ensure contenteditable is visible */
            white-space: normal; /* Allow text to wrap */
            word-break: break-word; /* Break long words */
        }

        .task-list li .task-due-date {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 3px 5px;
            font-size: 0.8em;
            color: var(--text-color);
            background-color: var(--background-color-secondary);
            max-width: 150px; /* Limit width of date input */
            margin-top: 4px; /* Space between text and date */
            outline: none;
        }

        .task-list li input[type="checkbox"] {
            min-width: 18px; /* Standardize checkbox size */
            min-height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .add-task-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            align-self: flex-start; /* Align button to the start */
            margin-top: auto; /* Push to the bottom */
        }

        .add-task-btn:hover {
            background-color: var(--primary-color);
            filter: brightness(0.9);
        }

        .progress-item {
            margin-top: 15px;
            text-align: center;
        }

        .progress-bar-container {
            width: 100%;
            background-color: var(--border-color);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--progress-bar-fill-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: bold;
            transition: width 0.4s ease-in-out, background-color 0.4s ease-in-out;
        }

        .progress-bar.full {
            background-color: var(--progress-bar-fill-complete);
        }

        .progress-label {
            font-size: 0.9em;
            color: var(--text-light);
        }

        /* Style for overdue tasks */
        .task-list li.overdue .task-text {
            color: #e74c3c; /* Red color for overdue text */
            font-weight: bold;
        }

        .task-list li.overdue .task-due-date {
            border-color: #e74c3c; /* Red border for overdue date input */
            color: #e74c3c; /* Red text for overdue date */
        }

        /* Style for completed tasks */
        .task-list li.completed .task-text {
            text-decoration: line-through;
            color: var(--text-light); /* Lighter color for completed tasks */
        }

        .task-list li.completed.overdue .task-text {
            color: var(--text-light); /* Keep text light even if completed and overdue */
        }

        /* Delete button for tasks */
        .delete-task-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.2em;
            cursor: pointer;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        .delete-task-btn:hover {
            color: #e74c3c; /* Red on hover */
        }


        /* Reminders Widget */
        .reminders-widget {
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }

        #remindersList {
            list-style: none;
            margin-bottom: 15px;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        #remindersList li {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            gap: 10px;
        }

        #remindersList li:last-child {
            border-bottom: none;
        }

        .reminder-checkbox {
            min-width: 18px;
            min-height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .reminder-details {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .reminder-text {
            font-size: 1em;
            color: var(--text-color);
        }

        .reminder-text.completed {
            text-decoration: line-through;
            color: var(--text-light);
        }

        .reminder-date {
            font-size: 0.8em;
            color: var(--text-light);
            margin-top: 2px;
        }

        .delete-reminder-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.2em;
            cursor: pointer;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        .delete-reminder-btn:hover {
            color: #e74c3c;
        }

        .new-reminder-input-group {
            display: flex;
            margin-top: auto; /* Push to bottom */
            gap: 10px;
        }

        #newReminderInput {
            flex-grow: 1;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--background-color);
            color: var(--text-color);
            outline: none;
        }

        #addReminderBtn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #addReminderBtn:hover {
            background-color: var(--primary-color);
            filter: brightness(0.9);
        }

        /* Mood Tracker Widget */
        .mood-tracker-widget {
            text-align: center;
        }

        .mood-emoji-grid {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mood-emoji-trigger {
            background: none;
            border: none;
            font-size: 2.5em;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 5px;
            border-radius: 8px; /* For hover effect */
        }

        .mood-emoji-trigger:hover {
            transform: scale(1.1);
            background-color: var(--border-color);
        }

        .mood-log-summary {
            list-style: none;
            text-align: left;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            margin-top: 15px;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .mood-log-summary li {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 0;
            border-bottom: 1px dotted var(--border-color);
        }

        .mood-log-summary li:last-child {
            border-bottom: none;
        }

        .mood-log-summary .log-emoji {
            font-size: 1.5em;
            min-width: 30px;
            text-align: center;
        }

        .mood-log-summary .log-details {
            flex-grow: 1;
        }

        .mood-log-summary .log-note {
            font-size: 0.9em;
            color: var(--text-color);
            margin-bottom: 2px;
        }

        .mood-log-summary .log-timestamp {
            font-size: 0.75em;
            color: var(--text-light);
        }

        .empty-log-message {
            font-style: italic;
            color: var(--text-light);
            text-align: center;
            padding: 20px 0;
        }

        .view-log-tab {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .view-log-tab button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .view-log-tab button:hover {
            background-color: var(--secondary-color);
            filter: brightness(0.9);
        }


        /* Zodiac Widget */
        .zodiac-widget {
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .zodiac-widget p {
            font-size: 1.1em;
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .zodiac-widget a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }

        .zodiac-widget a:hover {
            color: var(--primary-color);
            filter: brightness(0.8);
        }

        /* General Buttons */
        .new-page-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 20px; /* Space below widgets */
            align-self: flex-start; /* Align to the left in flex container */
        }

        .new-page-btn:hover {
            background-color: var(--accent-color);
            filter: brightness(0.9);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            opacity: 0; /* Start hidden */
            pointer-events: none; /* Allow clicks through when hidden */
            transition: opacity 0.4s ease-in-out;
        }

        .modal-overlay.fade-out {
            opacity: 0;
        }

        .modal-overlay[style*="display: flex"] {
            opacity: 1; /* Show when flex display is active */
            pointer-events: auto; /* Enable clicks when visible */
        }

        .modal-content {
            background-color: var(--background-color-secondary);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px var(--shadow-color);
            max-width: 500px;
            width: 90%;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        .modal-overlay[style*="display: flex"] .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            font-size: 1.8em;
            color: var(--primary-color);
        }

        .modal-header .close-btn {
            font-size: 2em;
            padding: 0 5px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-body p {
            margin-bottom: 10px;
        }

        .modal-body input[type="text"],
        .modal-body input[type="time"],
        .modal-body textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--background-color);
            color: var(--text-color);
            outline: none;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-footer button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }

        .modal-footer .confirm-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .modal-footer .confirm-btn:hover {
            background-color: var(--primary-color);
            filter: brightness(0.9);
        }

        .modal-footer .cancel-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .modal-footer .cancel-btn:hover {
            background-color: var(--secondary-color);
            filter: brightness(0.9);
        }

        /* Reminder Calendar Modal */
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px;
        }

        .calendar-nav button {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            color: var(--primary-color);
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .calendar-nav button:hover {
            background-color: var(--border-color);
        }

        #calendarGrid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
            margin-bottom: 15px;
        }

        .calendar-day-name {
            font-weight: bold;
            color: var(--text-light);
            padding: 5px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-day {
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            position: relative;
            font-size: 0.9em;
        }

        .calendar-day:hover {
            background-color: var(--border-color);
        }

        .calendar-day.today {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        .calendar-day.selected {
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
            border: 2px solid var(--primary-color);
        }

        .calendar-day.today.selected {
            background-color: var(--primary-color);
            border-color: var(--accent-color); /* Highlight selected today */
        }

        .reminder-dot {
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            background-color: var(--progress-bar-fill-2); /* Yellow dot */
            border-radius: 50%;
        }

        /* Full Mood Log View Modal */
        #fullLogListContainer {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        #fullLogListContainer li {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        #fullLogListContainer li:last-child {
            border-bottom: none;
        }

        #fullLogListContainer .log-emoji {
            font-size: 2.2em;
            min-width: 40px;
            text-align: center;
        }

        #fullLogListContainer .log-details {
            flex-grow: 1;
        }

        #fullLogListContainer .log-note {
            font-size: 1em;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        #fullLogListContainer .log-timestamp {
            font-size: 0.8em;
            color: var(--text-light);
        }

        .empty-full-log-message {
            font-style: italic;
            color: var(--text-light);
            text-align: center;
            padding: 30px 0;
            font-size: 1.1em;
        }

        /* Confetti */
        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks through */
            z-index: 999;
            overflow: hidden;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: red; /* Default, overridden by JS */
            opacity: 0;
            animation: fall var(--animation-duration) forwards ease-out;
            transform-origin: center center;
            transform: rotateZ(var(--rotation-start)) translateX(var(--translateX-start)) translateY(var(--translateY-start));
        }

        @keyframes fall {
            0% {
                opacity: 0;
                transform: translateY(-50px) rotateZ(0deg) scale(0.8);
            }
            10% {
                opacity: 1;
                transform: translateY(0) rotateZ(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotateZ(720deg) scale(0.5);
            }
        }
    </style>
</head>
<body>
    <header class="dashboard-header">
        <div class="header-left">
            <h1>Welcome to Your Dashboard!</h1>
            <p id="motivationalQuoteP">"Your daily dose of inspiration."</p>
        </div>
        <div class="header-right">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search...">
                <button id="searchButton">Go</button>
            </div>
            <button id="themeToggleBtn" class="theme-toggle-btn">
                <span id="themeIcon">‚òÄÔ∏è</span>
            </button>
        </div>
    </header>

    <main class="widgets-grid">
        <section class="widget quote-widget">
            <div class="widget-header">
                <h2>Daily Insight</h2>
            </div>
            <p id="motivationalQuoteP">"Loading quote..."</p>
        </section>

        <section class="widget reminders-widget">
            <div class="widget-header">
                <h2>Reminders</h2>
            </div>
            <ul id="remindersList">
                </ul>
            <div class="new-reminder-input-group">
                <input type="text" id="newReminderInput" placeholder="Add a new reminder...">
                <button id="addReminderBtn">Set Date</button>
            </div>
        </section>

        <section class="widget mood-tracker-widget">
            <div class="widget-header">
                <h2>How Are You Feeling?</h2>
            </div>
            <div class="mood-emoji-grid">
                <button class="mood-emoji-trigger" data-mood="happy" data-emoji="üòä">üòä</button>
                <button class="mood-emoji-trigger" data-mood="neutral" data-emoji="üòê">üòê</button>
                <button class="mood-emoji-trigger" data-mood="sad" data-emoji="üòî">üòî</button>
                <button class="mood-emoji-trigger" data-mood="angry" data-emoji="üò°">üò°</button>
                <button class="mood-emoji-trigger" data-mood="anxious" data-emoji="üòü">üòü</button>
            </div>
            <h3>Your Mood Log</h3>
            <ul id="moodLogListSummary" class="mood-log-summary">
                </ul>
            <div class="view-log-tab">
                <button id="viewMoodLogTabBtn">View Full Log</button>
            </div>
        </section>

        <section class="widget zodiac-widget">
            <div class="widget-header">
                <h2>Your Zodiac Prediction</h2>
            </div>
            <p id="zodiacPredictionText">Click below for your daily prediction!</p>
            <a href="#" id="zodiacLink">Get My Prediction</a>
        </section>

        </main>

    <button id="newPageBtn" class="new-page-btn">Add New To-Do List</button>

    <div id="moodLoggingModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="moodModalTitle">Log Your Mood <span id="modalSelectedMoodEmoji"></span></h3>
                <button class="close-btn" id="closeMoodModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>Add a note about why you're feeling this way:</p>
                <textarea id="moodNoteInput" rows="4" placeholder="e.g., Had a productive morning!"></textarea>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" id="cancelMoodLogBtn">Cancel</button>
                <button class="confirm-btn" id="saveMoodLogBtn">Save Mood</button>
            </div>
        </div>
    </div>

    <div id="reminderCalendarModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Set Reminder Date & Time</h3>
                <button class="close-btn" id="closeReminderCalendarBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calendar-nav">
                    <button id="prevMonthBtn">&lt;</button>
                    <h4 id="calendarMonthYear"></h4>
                    <button id="nextMonthBtn">&gt;</button>
                </div>
                <div id="calendarGrid">
                    </div>
                <label for="reminderTimeInput">Time:</label>
                <input type="time" id="reminderTimeInput">
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" id="cancelReminderBtn">Cancel</button>
                <button class="confirm-btn" id="setReminderBtn">Set Reminder</button>
            </div>
        </div>
    </div>

    <div id="fullMoodLogViewModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Your Full Mood Log</h3>
                <button class="close-btn" id="closeFullLogViewBtn">&times;</button>
            </div>
            <div class="modal-body">
                <ul id="fullLogListContainer">
                    </ul>
            </div>
        </div>
    </div>

    <div id="confetti-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let cardIdCounter = 0;
            let globalTaskCounter = 0;

            // --- THEME TOGGLE ---
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const themeIcon = document.getElementById('themeIcon');
            const body = document.body;

            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark') {
                body.classList.add('dark-mode');
                if (themeIcon) themeIcon.textContent = 'üåô';
            } else {
                if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
            }

            if (themeToggleBtn) {
                themeToggleBtn.addEventListener('click', () => {
                    body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light');
                    if (themeIcon) themeIcon.textContent = body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
                });
            }

            // --- MOTIVATIONAL QUOTE ---
            const quotes = [
                "The only way to do great work is to love what you do. ‚Äì Steve Jobs",
                "Believe you can and you're halfway there. ‚Äì Theodore Roosevelt",
                "Your limitation‚Äîit's only your imagination.",
                "The future belongs to those who believe in the beauty of their dreams. - Eleanor Roosevelt",
                "Strive not to be a success, but rather to be of value. - Albert Einstein"
            ];
            const quoteElement = document.getElementById('motivationalQuoteP');
            if (quoteElement) {
                // Ensure there are two elements with this ID, and update both
                document.querySelectorAll('#motivationalQuoteP').forEach(element => {
                    element.textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;
                });
            }

            const widgetsContainer = document.querySelector('.widgets-grid'); // Changed to .widgets-grid

            // --- HELPER: SELECT TEXT IN CONTENTEDITABLE ---
            function selectElementContents(el) {
                if(!el) return;
                const range = document.createRange(); range.selectNodeContents(el);
                const sel = window.getSelection();
                if (sel) { sel.removeAllRanges(); sel.addRange(range); }
            }

            // --- TODO CARD FUNCTIONALITY ---
            function createTodoCard() {
                cardIdCounter++;
                const cardId = `todoCard-${cardIdCounter}`;
                const cardElement = document.createElement('section');
                cardElement.classList.add('widget', 'todo-card');
                cardElement.id = cardId;
                cardElement.innerHTML = `
                    <div class="widget-header">
                        <h2 class="card-title"><span class="card-title-text" contenteditable="true">Untitled List ${cardIdCounter}</span></h2>
                        <button class="close-btn close-card-btn" title="Close this list">√ó</button>
                    </div>
                    <ul class="task-list"></ul>
                    <button class="add-task-btn">+ Add New Task</button>
                    <div class="progress-item">
                        <div class="progress-bar-container"><div class="progress-bar"></div></div>
                        <p class="progress-label">0% Complete</p>
                    </div>`;
                if (widgetsContainer) {
                    widgetsContainer.appendChild(cardElement);
                    // When a new card is created, add an initial task with a default empty due date
                    addTaskToTodoCard(cardElement, { text: "New Task", dueDate: "", completed: false });
                    updateProgressForCard(cardElement);
                    const cardTitleText = cardElement.querySelector('.card-title-text');
                    if (cardTitleText) {
                        cardTitleText.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); cardTitleText.blur();}});
                        cardTitleText.focus();
                        selectElementContents(cardTitleText);
                    }
                    saveTodoCards(); // Save state after adding a new card
                }
            }

            // Modified to accept a task object with text, dueDate, and completed status
            function addTaskToTodoCard(cardElement, task = { text: "New Task", dueDate: "", completed: false }) {
                globalTaskCounter++;
                const taskId = `dynamic-task-${globalTaskCounter}`;
                const taskList = cardElement.querySelector('.task-list');
                if (!taskList) return;

                const taskItem = document.createElement('li');
                taskItem.setAttribute('data-task-id', taskId); // Assign a unique ID to the li
                taskItem.innerHTML = `
                    <input type="checkbox" id="task-${taskId}" ${task.completed ? 'checked' : ''}>
                    <label for="task-${taskId}" class="task-label-wrapper">
                        <span class="task-text" contenteditable="true">${task.text}</span>
                        <input type="date" class="task-due-date" value="${task.dueDate}">
                    </label>
                    <button class="delete-task-btn" title="Delete Task">&times;</button>
                `;
                taskList.appendChild(taskItem);

                const newLabel = taskItem.querySelector('.task-text');
                if (newLabel) {
                    newLabel.addEventListener('blur', () => {
                        updateProgressForCard(cardElement);
                        saveTodoCards(); // Save state after editing
                    });
                    newLabel.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); newLabel.blur();}});
                }

                const dueDateInput = taskItem.querySelector('.task-due-date');
                if (dueDateInput) {
                    dueDateInput.addEventListener('change', () => {
                        updateProgressForCard(cardElement); // Re-evaluate progress (and color) when date changes
                        saveTodoCards(); // Save state after date changes
                    });
                }

                const deleteBtn = taskItem.querySelector('.delete-task-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        taskItem.remove();
                        updateProgressForCard(cardElement);
                        saveTodoCards(); // Save state after deleting
                    });
                }

                // Call renderTask to apply overdue styling immediately on creation/load
                renderTask(taskItem);
                updateProgressForCard(cardElement); // This also calls renderTask for all tasks in the card
            }

            // Helper function to render/update a single task item's appearance
            function renderTask(taskItem) {
                const dueDateInput = taskItem.querySelector('.task-due-date');
                const checkbox = taskItem.querySelector('input[type="checkbox"]');
                const taskTextSpan = taskItem.querySelector('.task-text');

                // Always remove before adding to ensure correct state
                taskItem.classList.remove('overdue', 'completed');

                if (checkbox.checked) {
                    taskItem.classList.add('completed');
                } else if (dueDateInput && dueDateInput.value) {
                    const dueDate = new Date(dueDateInput.value);
                    const today = new Date();
                    // Normalize today to start of day for comparison
                    today.setHours(0, 0, 0, 0);

                    // If the due date is in the past (or today, if you want "today" to be overdue)
                    // We'll consider it overdue if the due date has passed.
                    if (dueDate < today) {
                        taskItem.classList.add('overdue');
                    }
                }
            }


            function updateProgressForCard(cardElement) {
                const checkboxes = cardElement.querySelectorAll('.task-list input[type="checkbox"]');
                const progressBar = cardElement.querySelector('.progress-bar');
                const progressLabel = cardElement.querySelector('.progress-label');
                if (!progressBar || !progressLabel) return;
                const totalTasks = checkboxes.length;
                let checkedTasks = 0;
                checkboxes.forEach(cb => {
                    if (cb.checked) checkedTasks++;
                    // Re-render each task to ensure overdue status is up-to-date
                    renderTask(cb.closest('li'));
                });
                const percentage = totalTasks === 0 ? 0 : Math.round((checkedTasks / totalTasks) * 100);
                progressBar.style.width = `${percentage}%`;
                progressBar.textContent = `${percentage}%`;
                progressLabel.textContent = `${checkedTasks} of ${totalTasks} tasks complete (${percentage}%)`;
                if (percentage === 100 && totalTasks > 0) {
                    progressBar.classList.add('full');
                    progressBar.style.backgroundColor = 'var(--progress-bar-fill-complete)';
                } else {
                    progressBar.classList.remove('full');
                    progressBar.style.backgroundColor = percentage < 50 ? 'var(--progress-bar-fill-1)' : 'var(--progress-bar-fill-2)';
                }
                saveTodoCards(); // Save state after progress update
            }

            if (widgetsContainer) {
                widgetsContainer.addEventListener('click', function(event) {
                    const target = event.target;
                    if (target.classList.contains('add-task-btn')) {
                        const cardElement = target.closest('.todo-card');
                        if (cardElement) addTaskToTodoCard(cardElement);
                    }
                    if (target.classList.contains('close-card-btn')) {
                        const cardElement = target.closest('.todo-card');
                        if (cardElement) cardElement.remove();
                        saveTodoCards(); // Save state after removing card
                    }
                });
                widgetsContainer.addEventListener('change', function(event) {
                    const target = event.target;
                    if (target.matches('.todo-card .task-list input[type="checkbox"]')) {
                        const cardElement = target.closest('.todo-card');
                        if (cardElement) {
                            if (target.checked) triggerConfetti();
                            updateProgressForCard(cardElement);
                        }
                    }
                });
            }

            const newPageButton = document.getElementById('newPageBtn');
            if (newPageButton) newPageButton.addEventListener('click', createTodoCard);

            // --- LOCAL STORAGE FOR TODO CARDS ---
            function saveTodoCards() {
                const todoCardsData = [];
                document.querySelectorAll('.todo-card').forEach(cardElement => {
                    const cardId = cardElement.id;
                    const cardTitle = cardElement.querySelector('.card-title-text').textContent;
                    const tasks = [];
                    cardElement.querySelectorAll('.task-list li').forEach(taskItem => {
                        const checkbox = taskItem.querySelector('input[type="checkbox"]');
                        const text = taskItem.querySelector('.task-text').textContent;
                        const dueDate = taskItem.querySelector('.task-due-date').value;
                        const completed = checkbox.checked;
                        tasks.push({ text, dueDate, completed });
                    });
                    todoCardsData.push({ id: cardId, title: cardTitle, tasks: tasks });
                });
                localStorage.setItem('todoCards', JSON.stringify(todoCardsData));
            }

            function loadTodoCards() {
                const storedTodoCards = localStorage.getItem('todoCards');
                if (storedTodoCards) {
                    const todoCardsData = JSON.parse(storedTodoCards);
                    // Clear existing dummy cards if any (though typically there won't be if loading from scratch)
                    // If you have static initial cards in HTML, you might want to remove them here first.
                    // For this example, assuming all cards are dynamic.
                    document.querySelector('.widgets-grid').innerHTML = ''; // Clear only dynamically added widgets

                    todoCardsData.forEach(cardData => {
                        // Update cardIdCounter to ensure new cards get unique, increasing IDs
                        const currentCardNum = parseInt(cardData.id.replace('todoCard-', '')) || 0;
                        if (currentCardNum > cardIdCounter) {
                            cardIdCounter = currentCardNum;
                        }

                        const cardElement = document.createElement('section');
                        cardElement.classList.add('widget', 'todo-card');
                        cardElement.id = cardData.id; // Restore original ID
                        cardElement.innerHTML = `
                            <div class="widget-header">
                                <h2 class="card-title"><span class="card-title-text" contenteditable="true">${cardData.title}</span></h2>
                                <button class="close-btn close-card-btn" title="Close this list">√ó</button>
                            </div>
                            <ul class="task-list"></ul>
                            <button class="add-task-btn">+ Add New Task</button>
                            <div class="progress-item">
                                <div class="progress-bar-container"><div class="progress-bar"></div></div>
                                <p class="progress-label">0% Complete</p>
                            </div>`;
                        widgetsContainer.appendChild(cardElement); // Append to the main grid

                        cardData.tasks.forEach(task => {
                            // Update globalTaskCounter to ensure new tasks get unique, increasing IDs
                            const currentTaskNum = parseInt(task.id ? task.id.replace('dynamic-task-', '') : 0) || 0; // Assuming tasks might have an id now if saved
                            if (currentTaskNum > globalTaskCounter) {
                                globalTaskCounter = currentTaskNum;
                            }
                            addTaskToTodoCard(cardElement, task); // Use the modified addTaskToTodoCard that accepts an object
                        });
                        updateProgressForCard(cardElement); // Update progress and apply overdue styling
                    });
                    // Increment cardIdCounter by 1 after loading all cards to avoid ID conflicts for newly created cards
                    cardIdCounter++;
                    globalTaskCounter++; // Same for tasks
                }
            }

            // --- ENHANCED REMINDERS WIDGET V3 (With Notifications) ---
            const remindersListEl = document.getElementById('remindersList');
            const newReminderInput = document.getElementById('newReminderInput');
            const addReminderBtn = document.getElementById('addReminderBtn');

            const reminderCalendarModal = document.getElementById('reminderCalendarModal');
            const calendarMonthYearEl = document.getElementById('calendarMonthYear');
            const prevMonthBtn = document.getElementById('prevMonthBtn');
            const nextMonthBtn = document.getElementById('nextMonthBtn');
            const calendarGridEl = document.getElementById('calendarGrid');
            const reminderTimeInput = document.getElementById('reminderTimeInput');
            const setReminderBtn = document.getElementById('setReminderBtn');
            const cancelReminderBtn = document.getElementById('cancelReminderBtn');

            let reminders = [];
            let calendarDate = new Date();
            let selectedDate = null;
            let reminderTextToSet = '';

            // --- NEW: Notification Logic ---
            function requestNotificationPermission() {
                if (!("Notification" in window)) {
                    console.log("This browser does not support desktop notification");
                } else if (Notification.permission === "default") {
                    Notification.requestPermission();
                }
            }

            function showNotification(reminderText) {
                if (Notification.permission === "granted") {
                    new Notification("Upcoming Reminder!", {
                        body: reminderText,
                        // icon: "path/to/your/your/icon.png" // Optional: Add an icon
                    });
                } else {
                    // Fallback for when permission is denied or not granted
                    alert(`Reminder: ${reminderText}`);
                }
            }

            function checkRemindersForNotification() {
                const now = new Date().getTime();
                const oneHour = 60 * 60 * 1000;
                let needsSave = false;

                reminders.forEach(reminder => {
                    const dueDate = new Date(reminder.dueDate).getTime();
                    // Check if reminder is in the future, within the hour, not completed, and not already notified
                    if (dueDate > now && (dueDate - now) <= oneHour && !reminder.completed && !reminder.notified) {
                        showNotification(reminder.text);
                        reminder.notified = true; // Mark as notified
                        needsSave = true;
                    }
                });

                if (needsSave) {
                    saveReminders(); // Save the updated 'notified' status
                }
            }

            // --- End of new Notification Logic ---

            function loadReminders() {
                const storedReminders = localStorage.getItem('reminders');
                if (storedReminders) {
                    reminders = JSON.parse(storedReminders);
                    reminders.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                }
                renderReminders();
            }

            function saveReminders() {
                reminders.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
                localStorage.setItem('reminders', JSON.stringify(reminders));
            }

            function formatDueDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                let datePart;
                const dateToCompare = new Date(date.getFullYear(), date.getMonth(), date.getDate());

                if (dateToCompare.getTime() === today.getTime()) {
                    datePart = 'Today';
                } else if (dateToCompare.getTime() === tomorrow.getTime()) {
                    datePart = 'Tomorrow';
                } else {
                    datePart = date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
                }

                const timePart = date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', hour12: true });
                return `${datePart} at ${timePart}`;
            }

            function renderReminders() {
                if (!remindersListEl) return;
                remindersListEl.innerHTML = '';

                if (reminders.length === 0) {
                    const emptyLi = document.createElement('li');
                    emptyLi.textContent = 'No reminders yet. Add one below!';
                    emptyLi.style.cssText = 'text-align: center; color: var(--text-light); border-bottom: none; padding: 10px 0;';
                    remindersListEl.appendChild(emptyLi);
                    return;
                }

                reminders.forEach(reminder => {
                    const li = document.createElement('li');
                    li.dataset.id = reminder.id;

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.classList.add('reminder-checkbox');
                    checkbox.checked = reminder.completed;
                    checkbox.addEventListener('change', () => toggleReminderComplete(reminder.id));

                    const detailsDiv = document.createElement('div');
                    detailsDiv.className = 'reminder-details';

                    const textSpan = document.createElement('div');
                    textSpan.classList.add('reminder-text');
                    textSpan.textContent = reminder.text;
                    if (reminder.completed) {
                        textSpan.classList.add('completed');
                    }

                    const dateSpan = document.createElement('div');
                    dateSpan.className = 'reminder-date';
                    dateSpan.textContent = formatDueDate(reminder.dueDate);

                    detailsDiv.appendChild(textSpan);
                    detailsDiv.appendChild(dateSpan);

                    const deleteBtn = document.createElement('button');
                    deleteBtn.classList.add('delete-reminder-btn');
                    deleteBtn.innerHTML = '&times;';
                    deleteBtn.title = "Delete Reminder";
                    deleteBtn.addEventListener('click', () => deleteReminder(reminder.id));

                    li.appendChild(checkbox);
                    li.appendChild(detailsDiv);
                    li.appendChild(deleteBtn);
                    remindersListEl.appendChild(li);
                });
            }

            function openCalendarModal() {
                reminderTextToSet = newReminderInput.value.trim();
                if (reminderTextToSet === '') {
                    alert("Please type a reminder message first!");
                    newReminderInput.focus();
                    return;
                }

                selectedDate = new Date();
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                reminderTimeInput.value = `${hours}:${minutes}`;

                generateCalendar();
                reminderCalendarModal.classList.remove('fade-out');
                reminderCalendarModal.style.display = 'flex';
            }

            function closeCalendarModal() {
                reminderCalendarModal.classList.add('fade-out');
                setTimeout(() => {
                    reminderCalendarModal.style.display = 'none';
                }, 400);
            }

            function generateCalendar() {
                calendarGridEl.innerHTML = '';
                const month = calendarDate.getMonth();
                const year = calendarDate.getFullYear();

                calendarMonthYearEl.textContent = `${calendarDate.toLocaleString('default', { month: 'long' })} ${year}`;

                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayNames.forEach(day => {
                    const dayNameEl = document.createElement('div');
                    dayNameEl.classList.add('calendar-day-name');
                    dayNameEl.textContent = day;
                    calendarGridEl.appendChild(dayNameEl);
                });

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                const reminderDates = reminders.map(r => {
                    const d = new Date(r.dueDate);
                    return `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
                });

                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarGridEl.appendChild(document.createElement('div'));
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('calendar-day');
                    dayEl.textContent = i;
                    dayEl.dataset.date = new Date(year, month, i);

                    const today = new Date();
                    if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayEl.classList.add('today');
                    }
                    if (selectedDate && i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                        dayEl.classList.add('selected');
                    }
                    if (reminderDates.includes(`${year}-${month}-${i}`)) {
                        const dot = document.createElement('div');
                        dot.className = 'reminder-dot';
                        dayEl.appendChild(dot);
                    }

                    dayEl.addEventListener('click', () => {
                        selectedDate = new Date(year, month, i);
                        document.querySelectorAll('.calendar-day.selected').forEach(d => d.classList.remove('selected'));
                        dayEl.classList.add('selected');
                    });
                    calendarGridEl.appendChild(dayEl);
                }
            }

            prevMonthBtn.addEventListener('click', () => {
                calendarDate.setMonth(calendarDate.getMonth() - 1);
                generateCalendar();
            });
            nextMonthBtn.addEventListener('click', () => {
                calendarDate.setMonth(calendarDate.getMonth() + 1);
                generateCalendar();
            });

            function confirmAndSetReminder() {
                requestNotificationPermission(); // Ask for permission when user sets a reminder

                if (!selectedDate || !reminderTextToSet) return;

                const timeParts = reminderTimeInput.value.split(':');
                selectedDate.setHours(timeParts[0] || 0);
                selectedDate.setMinutes(timeParts[1] || 0);
                selectedDate.setSeconds(0);

                const newReminder = {
                    id: `rem-${Date.now()}`,
                    text: reminderTextToSet,
                    completed: false,
                    dueDate: selectedDate.toISOString(),
                    notified: false // NEW: Add notified flag
                };
                reminders.push(newReminder);
                saveReminders();
                renderReminders();
                newReminderInput.value = '';
                closeCalendarModal();
            }

            setReminderBtn.addEventListener('click', confirmAndSetReminder);
            cancelReminderBtn.addEventListener('click', closeCalendarModal);

            function deleteReminder(reminderId) {
                reminders = reminders.filter(r => r.id !== reminderId);
                saveReminders();
                renderReminders();
            }

            function toggleReminderComplete(reminderId) {
                const reminder = reminders.find(r => r.id === reminderId);
                if (reminder) {
                    reminder.completed = !reminder.completed;
                    saveReminders();
                    renderReminders();
                }
            }

            addReminderBtn.addEventListener('click', openCalendarModal);
            newReminderInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    openCalendarModal();
                }
            });
            loadReminders();


            // --- ENHANCED MOOD TRACKER ---
            const moodEmojiTriggers = document.querySelectorAll('.mood-emoji-trigger');
            const moodLoggingModal = document.getElementById('moodLoggingModal');
            const modalSelectedMoodEmoji = document.getElementById('modalSelectedMoodEmoji');
            const moodNoteInput = document.getElementById('moodNoteInput');
            const saveMoodLogBtn = document.getElementById('saveMoodLogBtn');
            const cancelMoodLogBtn = document.getElementById('cancelMoodLogBtn');

            const moodLogListSummaryEl = document.getElementById('moodLogListSummary');

            const viewMoodLogTabBtn = document.getElementById('viewMoodLogTabBtn');
            const fullMoodLogViewModal = document.getElementById('fullMoodLogViewModal');
            const closeFullLogViewBtn = document.getElementById('closeFullLogViewBtn');
            const fullLogListContainer = document.getElementById('fullLogListContainer');

            let currentSelectedMood = { type: '', emoji: ''};

            function openMoodModal(moodType, moodEmoji) {
                currentSelectedMood.type = moodType;
                currentSelectedMood.emoji = moodEmoji;
                if(modalSelectedMoodEmoji) modalSelectedMoodEmoji.textContent = moodEmoji;
                if(moodNoteInput) moodNoteInput.value = '';
                if(moodLoggingModal) {
                    moodLoggingModal.classList.remove('fade-out');
                    moodLoggingModal.style.display = 'flex';
                }
                if(moodNoteInput) moodNoteInput.focus();
            }

            function closeMoodModal() {
                if(moodLoggingModal) {
                    moodLoggingModal.classList.add('fade-out');
                    setTimeout(() => {
                        moodLoggingModal.style.display = 'none';
                    }, 400);
                }
            }

            if (moodEmojiTriggers) {
                moodEmojiTriggers.forEach(trigger => {
                    trigger.addEventListener('click', function() {
                        openMoodModal(this.dataset.mood, this.dataset.emoji);
                    });
                });
            }

            if (saveMoodLogBtn) {
                saveMoodLogBtn.addEventListener('click', () => {
                    const note = moodNoteInput.value.trim();
                    const timestamp = new Date();
                    const moodEntry = {
                        mood: currentSelectedMood.type, emoji: currentSelectedMood.emoji,
                        note: note, timestamp: timestamp.toISOString()
                    };
                    saveMoodEntry(moodEntry);
                    renderMoodLogSummary();
                    if (fullMoodLogViewModal && fullMoodLogViewModal.style.display === 'flex') {
                        renderFullMoodLog();
                    }
                    closeMoodModal();
                });
            }

            if(cancelMoodLogBtn) cancelMoodLogBtn.addEventListener('click', closeMoodModal);

            function getMoodLog() {
                return JSON.parse(localStorage.getItem('moodLog') || '[]');
            }
            function saveMoodEntry(entry) {
                const log = getMoodLog(); log.unshift(entry);
                localStorage.setItem('moodLog', JSON.stringify(log));
            }

            function renderMoodLogSummary() {
                const log = getMoodLog();
                if (!moodLogListSummaryEl) return;
                moodLogListSummaryEl.innerHTML = '';
                if (log.length === 0) {
                    moodLogListSummaryEl.innerHTML = '<p class="empty-log-message">No moods logged yet. Click an emoji below to start!</p>';
                    return;
                }
                const summaryLog = log.slice(0, 5);
                summaryLog.forEach(entry => {
                    const li = document.createElement('li');
                    const entryDate = new Date(entry.timestamp);
                    const formattedTimestamp = entryDate.toLocaleString(undefined, {
                        month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                    });
                    li.innerHTML = `
                        <span class="log-emoji">${entry.emoji}</span>
                        <div class="log-details">
                            <p class="log-note">${(entry.note ? entry.note.substring(0, 50) + (entry.note.length > 50 ? '...' : '') : '<em>No note</em>')}</p>
                            <p class="log-timestamp">${formattedTimestamp}</p>
                        </div>`;
                    moodLogListSummaryEl.appendChild(li);
                });
            }

            function renderFullMoodLog() {
                const log = getMoodLog();
                if (!fullLogListContainer) return;
                fullLogListContainer.innerHTML = '';
                if (log.length === 0) {
                    fullLogListContainer.innerHTML = '<p class="empty-full-log-message">Your mood log is empty. Start logging your mood using the emojis below!</p>';
                    return;
                }
                log.forEach(entry => {
                    const li = document.createElement('li');
                    const entryDate = new Date(entry.timestamp);
                    const formattedTimestamp = entryDate.toLocaleString(undefined, {
                        year: 'numeric', month: 'long', day: 'numeric',
                        hour: '2-digit', minute: '2-digit', second: '2-digit'
                    });
                    li.innerHTML = `
                        <span class="log-emoji">${entry.emoji}</span>
                        <div class="log-details">
                            <p class="log-note">${entry.note || '<em>No note added for this entry.</em>'}</p>
                            <p class="log-timestamp">Logged on: ${formattedTimestamp}</p>
                        </div>`;
                    fullLogListContainer.appendChild(li);
                });
            }

            if (viewMoodLogTabBtn) {
                viewMoodLogTabBtn.addEventListener('click', () => {
                    renderFullMoodLog();
                    if(fullMoodLogViewModal) {
                           fullMoodLogViewModal.classList.remove('fade-out');
                           fullMoodLogViewModal.style.display = 'flex';
                    }
                });
            }

            function closeFullLogViewModal() {
                   if(fullMoodLogViewModal) {
                       fullMoodLogViewModal.classList.add('fade-out');
                       setTimeout(() => {
                           fullMoodLogViewModal.style.display = 'none';
                       }, 400);
                   }
            }

            if(closeFullLogViewBtn) closeFullLogViewBtn.addEventListener('click', closeFullLogViewModal);

            // Close modal when clicking on the overlay
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        // Check which modal it is and call its specific close function
                        if(modal.id === 'fullMoodLogViewModal') closeFullLogViewModal();
                        if(modal.id === 'moodLoggingModal') closeMoodModal();
                        if(modal.id === 'reminderCalendarModal') closeCalendarModal();
                    }
                });
            });

            renderMoodLogSummary();


            // --- ZODIAC PREDICTION ---
            const zodiacLink = document.getElementById('zodiacLink');
            const zodiacPredictionText = document.getElementById('zodiacPredictionText');
            const zodiacPredictions = ["Today is a good day for learning.", "Expect a pleasant surprise!", "Focus on tasks.", "A new opportunity awaits!", "Your creativity is flowing freely today."];
            if(zodiacLink && zodiacPredictionText) {
                zodiacLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    zodiacPredictionText.textContent = zodiacPredictions[Math.floor(Math.random() * zodiacPredictions.length)];
                });
            }

            // --- CONFETTI FUNCTION ---
            const confettiContainer = document.getElementById('confetti-container');
            function triggerConfetti() {
                if (!confettiContainer) return;
                confettiContainer.innerHTML = '';
                for (let i = 0; i < 50; i++) {
                    const piece = document.createElement('div');
                    piece.classList.add('confetti-piece');
                    piece.style.left = `${Math.random() * window.innerWidth}px`;
                    piece.style.top = `${-20 - (Math.random() * 50)}px`;
                    const colors = ['#FFC107', '#4CAF50', '#2196F3', '#E91E63', '#9C27B0', '#FFEB3B'];
                    piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    piece.style.width = (Math.random() * 6 + 4) + 'px';
                    piece.style.height = (Math.random() * 10 + 6) + 'px';
                    if(Math.random() > 0.5) piece.style.borderRadius = '50%';
                    piece.style.animationDuration = (Math.random() * 1 + 2) + 's';
                    piece.style.animationDelay = (Math.random() * 0.2) + 's';
                    confettiContainer.appendChild(piece);
                    setTimeout(() => piece.remove(), parseFloat(piece.style.animationDuration) * 1000 + parseFloat(piece.style.animationDelay) * 1000 + 100);
                }
            }

            // --- SEARCH FUNCTIONALITY ---
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            if (searchInput && searchButton) {
                searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') searchButton.click(); });
                searchButton.addEventListener('click', () => {
                    const searchTerm = searchInput.value;
                    alert(searchTerm ? `Searching for: ${searchTerm}... (Not implemented)` : 'Please enter a search term.');
                });
            }

            // --- INITIALIZE TIMERS AND CHECKS ---
            setInterval(checkRemindersForNotification, 60000); // Check every minute
            checkRemindersForNotification(); // Also check once on page load

            // --- LOAD ALL DATA ON STARTUP ---
            loadTodoCards(); // Call this after all task-related functions are defined
        });
    </script>
</body>
</html>
